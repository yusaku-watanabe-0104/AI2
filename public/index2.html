<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>数列の達成価値（チャット版・ローカル実行）</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 0 1em;
      background: #fafafa;
    }
    .chat {
      display: flex;
      flex-direction: column;
      gap: 1em;
    }
    .bubble {
      padding: 10px 15px;
      border-radius: 10px;
      max-width: 80%;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    .ai {
      background-color: #e6f7ff;
      align-self: flex-start;
    }
    .user {
      background-color: #d1ffd6;
      align-self: flex-end;
    }
    #inputArea {
      display: flex;
      margin-top: 1em;
      gap: 0.5em;
    }
    #userInput {
      flex: 1;
      padding: 0.5em;
    }
  </style>
</head>
<body>
  <h1>あなたにとっての漸化式や数学的帰納法の意味</h1>
  <div id="chat" class="chat">
    <div class="bubble ai">こんにちは。これからいくつか質問をしますね。</div>
  </div>

  <div id="inputArea">
    <input type="text" id="userInput" placeholder="ここに入力してください" />
    <button onclick="handleInput()">送信</button>
  </div>

  <script>
    let step = 0;
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");
    const answers = {};

    const questions = [
      "出席番号を教えてください。",
      "あなたは自分のことをどんな人間だと思っていますか？",
      "あなたの理想の自分を教えてください。",
      "普段の生活や学校での行動を決めるとき、特に大事にしていることはありますか？",
      "近い未来（１年〜５年ほど）の目標を教えてください。",
      "何かに挑戦するとき、目標は「自分が成長すること」それとも「人よりも良い結果を出すこと」どちらが気になりますか？",
      "あなたはクラスにおいて，どんな役割を果たすことを期待されていると思いますか？"
    ];

    const keys = ["number", "selfImage", "idealSelf", "values", "future", "recentEffort", "kitai"];
    let afterValuePhase = false;

    function addMessage(text, sender = "ai") {
      const bubble = document.createElement("div");
      bubble.className = `bubble ${sender}`;
      bubble.textContent = text;
      chat.appendChild(bubble);
      chat.scrollTop = chat.scrollHeight;
    }

    async function handleInput() {
      const value = input.value.trim();
      if (!value) return;
      addMessage(value, "user");
      input.value = "";

      if (!afterValuePhase) {
        answers[keys[step]] = value;
        step++;
        if (step < questions.length) {
          setTimeout(() => addMessage(questions[step], "ai"), 600);
        } else {
          addMessage("少し考えますね…", "ai");
          await generateFakeCompletion();
        }
      } else {
        const reply = fakeFollowUp(value);
        setTimeout(() => addMessage(reply, "ai"), 700);
      }
    }

    async function generateFakeCompletion() {
      const text = `君が大事にしている「${answers.values}」って考え方、すごく素敵ですね。
これから学ぶ漸化式や数学的帰納法は、ただ公式を覚えるだけじゃなくて、
「どうすれば次に進めるか」を考える力を伸ばす単元なんです。
たとえば、等差数列や等比数列では決まった形の公式を使っていましたが、
漸化式では「一つ前の項から次を作る」という考え方をします。
これは、まさに君のように「${answers.values}」を大切にする人にぴったりの内容なんです。
これから学ぶ中で、自分の考え方と数学がどうつながるか、一緒に探していきましょう。`;

setTimeout(() => {
        addMessage(text, "ai");
        setTimeout(() => {
          addMessage("自分の目標に対して、この文章はどのように役立つと思いますか？", "ai");
          afterValuePhase = true;
        }, 2000);
      }, 1500);
    }

    function fakeFollowUp(userText) {
      const responses = [
        "なるほど、そう考えるのですね。",
        "それはとても良い視点ですね！",
        "面白い考え方です。",
        "いいですね。その考えをこれからの学びにも活かせそうです。"
      ];
      return responses[Math.floor(Math.random() * responses.length)];
    }
  </script>
</body>
</html>
